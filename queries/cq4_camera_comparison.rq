PREFIX sp: <http://example.org/smartphone#>
PREFIX spv: <http://example.org/smartphone/vocab/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# CQ4: Camera Quality Comparison (Specs + Sentiment)
# Question: Compare camera quality across phones using both technical specs and review sentiment

SELECT ?phoneName ?brandName
       ?mainCameraMP
       (COALESCE(?posCount, 0) AS ?positiveCameraSentiment)
       (COALESCE(?negCount, 0) AS ?negativeCameraSentiment)
       ((COALESCE(?posCount, 0) - COALESCE(?negCount, 0)) AS ?sentimentScore)
       ((?mainCameraMP / 100.0 + COALESCE(?posCount, 0) - COALESCE(?negCount, 0)) AS ?combinedScore)
WHERE {
  # Get phone with camera specs
  ?phone a sp:Smartphone ;
         sp:phoneName ?phoneName ;
         sp:hasBrand ?brand ;
         sp:mainCameraMP ?mainCameraMP .

  ?brand sp:brandName ?brandName .

  # Positive camera reviews
  OPTIONAL {
    SELECT ?phone (COUNT(?review) AS ?posCount)
    WHERE {
      ?review sp:reviewOf ?phone ;
              sp:hasPositiveSentimentTag spv:Camera .
    }
    GROUP BY ?phone
  }

  # Negative camera reviews
  OPTIONAL {
    SELECT ?phone (COUNT(?review) AS ?negCount)
    WHERE {
      ?review sp:reviewOf ?phone ;
              sp:hasNegativeSentimentTag spv:Camera .
    }
    GROUP BY ?phone
  }

  # Filter for phones with decent camera (>= 48MP) and some reviews
  FILTER(?mainCameraMP >= 48)
  FILTER(COALESCE(?posCount, 0) + COALESCE(?negCount, 0) > 0)
}
ORDER BY DESC(?combinedScore) DESC(?sentimentScore)
LIMIT 20
